# banana_device
一.设计背景
在小学期初步接触并学习了一些硬件设计课程之后，我展开了硬件设计大赛作品的制作，因为在学校电路实验中剥线操作很繁琐很费时，所以预期制作一个自动剪线器，最终决定加上遥控移动功能，将两者合并在一起，能够在较小区域提供给同学方便的剥线服务，因为线下联系队友距离较远，线上又不能很好地协同，所以本队伍仅有我一人，但是必须说明的是，在硬件设计的过程中，西南大学21级新生刘佳一，也是我非常好的朋友，帮了我不少忙，在此表示感谢。
二.开发过程
在开发初期，我们预期的功能十分明确：移动小车能够实现手机或者摇杆的无线控制，能够提供较大的攀爬立，因为上面会架上剪线部分，重量不小；剪线部分能够实现用户指定剥线长度及剥线段数后，按照设定剪剥线。其后的工作也基本按照这个思路展开。
我们首先展开了小车的制作，因为第一次进行类似的制作，缺乏很多经验，也缺乏很多工程制图，建模打板的经验，我们几乎是完全摸索着前进，小车的控制中心是arduino uno r3单片机，动力使用了PID位移式算法，实现闭环控制，同时通过简单的输入设置嗯能够实现加速减速。方向控制使用SG90舵机，在做完简单的工作后，我们需要进行无线传输的工作。首先想到的是用摇杆控制，无线传输模块使用NF2401无线射频模块，但是此模块在使用中难以调试，参考了很多教程。阅读了很多文档，花费了很长时间，还是无法在两个uno板子之间无线通信，最终，我们不得已寻找其他途径。我们想到了蓝牙，通过对学校发送的蓝牙模块进行AT命令调试，首先实现了通过电脑的串口助手无限传输，然后，我们将目光转向了安卓应用开发，这一部分主要由刘佳一同学负责，通过网上参考了一些蓝牙权限申请的代码，我们设计好了“传输协议”，当然，在如何读取并转化为我们需要的值时，也花费了一定精力，最终能够实现使用手机APP发送数据并控制小车的移动转向。
接下来是剪线部分的制作，传输部分我们仍然弃用NRF2401,使用ESP8266-01S模块，通过查阅相关资料，尝试了很久，最终通过AT指令调试解决问题。我们也考虑过直接使用wifiduino，由于接线孔少，最终弃用。我们先进行剪线的动力设计，预期是在电机转轴上安装一个齿轮，在齿轮盘上打洞，再通过这个洞搭配铁钩与钳子连接，从而实现钳子的上下运动，预期仍然使用普通直流电机，但是需要解决定时转动或者定圈转动的问题，通过对代码不断调试，电机能大致实现定时转动，但是，最短转动时间在3秒左右，圈数也难以做到较为精确的一整圈，所以方案行不通，于是我们希望将他用于传输导线，传输部分同样是通过电机，齿轮，通过摩擦力将导线传输至剪线部位，而这里同样需要定时控制，所以这一部分也不能适用。最终我们决定使用步进电机，通过A4988电机驱动模块控制，在调试电路中，需要使用电容进行滤波，同时手动调节驱动的电位，很不幸，由于操作的粗心，导致一个电机驱动当场烧坏，此时时间已经接近开学，于是，我将所需的其他部件发送到北京，预期在学校继续进行，但是此时疫情来袭，导致无法返校，同时外部快递无法邮寄进来，一时间硬件制作陷入停滞，我们只能利用手边的东西进行材料的制作。
小车的模型没有网上购买，底盘拆卸了我朋友弟弟已经坏掉的小车，很多部件都通过锡焊的高温熔化塑料进行塑性，包括小车的齿轮传动，舵机固定，拐弯机制的设计，很多都是通过其他的塑料进行粘合，周身通过纸板进行封装，最终做出了车体。剪线部分我们找了一块木板，通过测量等准备，手工锯木板，同时通过木板，钉子，螺丝等物品进行部件的固定，这一部分也是十分费力费时。
在临近报告提交前，快递仍然无法正常运行，我也无法前往北京，所以陷入了两难的地步。
三.模块使用
HC-05蓝牙模块；
L298N电机驱动;
SG-90舵机;
MG310电机;
3S 1100maH锂电池；
LED模块；
CH340 USB转TTL模块；
ESP8266-01Swifi模块；
SG-90舵机；
A4988电机驱动*2；
Nema17 步进电机*2；
0.96寸OLED显示屏（128×64 I2C借口）
剪线钳DL383005；
Arduino uno r3板*2；
四．  核心算法
在本次硬件设计中，所使用的对本项目较为重要的代码有：
1.PID位移式算法实现电机的闭环控制。
2.电机的中断计数及转速控制。
3.ESP8266-01S的AT指令设置WiFi信息，因为某些原因，这些指令需要以代码形式烧录进入控制板。
4.手机APP上蓝牙权限申请，WiFi连接相关，以及单片机接收解码相关代码。

